{"version":3,"file":"cli.js","sources":["../src/cli.js"],"sourcesContent":["import sade from 'sade';\nimport colors from 'kleur';\nimport { load_config } from './api/load_config';\nimport * as pkg from '../package.json';\n\nlet config;\n\ntry {\n\tconfig = load_config();\n} catch (error) {\n\tlet message = error.message;\n\n\tif (error.code === 'ENOENT') {\n\t\tmessage = 'Missing svelte.config.js';\n\t} else if (error.name === 'SyntaxError') {\n\t\tmessage = 'Malformed svelte.config.js';\n\t}\n\n\tconsole.error(colors.bold().red(message));\n\tconsole.error(colors.grey(error.stack));\n\tprocess.exit(1);\n}\n\nfunction handle_error(error) {\n\tconsole.log(colors.bold().red(`> ${error.message}`));\n\tconsole.log(colors.gray(error.stack));\n\tprocess.exit(1);\n}\n\nasync function launch(port) {\n\tconst { exec } = await import('child_process');\n\texec(`${process.platform == 'win32' ? 'start' : 'open'} http://localhost:${port}`);\n}\n\nconst prog = sade('svelte').version(pkg.version);\n\nprog\n\t.command('dev')\n\t.describe('Start a development server')\n\t.option('-p, --port', 'Port', 3000)\n\t.option('-o, --open', 'Open a browser tab', false)\n\t.action(async ({ port, open }) => {\n\t\tconst { dev } = await import('./api/dev');\n\n\t\ttry {\n\t\t\tconst watcher = await dev({ port, config });\n\n\t\t\twatcher.on('stdout', (data) => {\n\t\t\t\tprocess.stdout.write(data);\n\t\t\t});\n\n\t\t\twatcher.on('stderr', (data) => {\n\t\t\t\tprocess.stderr.write(data);\n\t\t\t});\n\n\t\t\tconsole.log(colors.bold().cyan(`> Listening on http://localhost:${watcher.port}`));\n\t\t\tif (open) launch(watcher.port);\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog\n\t.command('build')\n\t.describe('Create a production build of your app')\n\t.action(async () => {\n\t\tconst { build } = await import('./api/build');\n\n\t\ttry {\n\t\t\tawait build(config);\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog\n\t.command('start')\n\t.describe('Serve an already-built app')\n\t.option('-p, --port', 'Port', 3000)\n\t.option('-o, --open', 'Open a browser tab', false)\n\t.action(async ({ port, open }) => {\n\t\tconst { start } = await import('./api/start');\n\n\t\ttry {\n\t\t\tawait start({ port, config });\n\n\t\t\tconsole.log(colors.bold().cyan(`> Listening on http://localhost:${port}`));\n\t\t\tif (open) if (open) launch(port);\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog\n\t.command('adapt')\n\t.describe('Customise your production build for different platforms')\n\t.action(async () => {\n\t\tconst { adapt } = await import('./api/adapt');\n\n\t\ttry {\n\t\t\tawait adapt(config);\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog.parse(process.argv, { unknown: (arg) => `Unknown option: ${arg}` });\n"],"names":["load_config","colors","sade","pkg.version"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,IAAI,MAAM,CAAC;AACX;AACA,IAAI;AACJ,CAAC,MAAM,GAAGA,oBAAW,EAAE,CAAC;AACxB,CAAC,CAAC,OAAO,KAAK,EAAE;AAChB,CAAC,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;AAC7B;AACA,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE;AAC9B,EAAE,OAAO,GAAG,0BAA0B,CAAC;AACvC,EAAE,MAAM,IAAI,KAAK,CAAC,IAAI,KAAK,aAAa,EAAE;AAC1C,EAAE,OAAO,GAAG,4BAA4B,CAAC;AACzC,EAAE;AACF;AACA,CAAC,OAAO,CAAC,KAAK,CAACC,UAAM,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;AAC3C,CAAC,OAAO,CAAC,KAAK,CAACA,UAAM,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;AACzC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACjB,CAAC;AACD;AACA,SAAS,YAAY,CAAC,KAAK,EAAE;AAC7B,CAAC,OAAO,CAAC,GAAG,CAACA,UAAM,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;AACtD,CAAC,OAAO,CAAC,GAAG,CAACA,UAAM,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;AACvC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACjB,CAAC;AACD;AACA,eAAe,MAAM,CAAC,IAAI,EAAE;AAC5B,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,mFAAO,eAAe,MAAC,CAAC;AAChD,CAAC,IAAI,CAAC,CAAC,EAAE,OAAO,CAAC,QAAQ,IAAI,OAAO,GAAG,OAAO,GAAG,MAAM,CAAC,kBAAkB,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;AACpF,CAAC;AACD;AACA,MAAM,IAAI,GAAGC,wBAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAACC,gBAAW,CAAC,CAAC;AACjD;AACA,IAAI;AACJ,EAAE,OAAO,CAAC,KAAK,CAAC;AAChB,EAAE,QAAQ,CAAC,4BAA4B,CAAC;AACxC,EAAE,MAAM,CAAC,YAAY,EAAE,MAAM,EAAE,IAAI,CAAC;AACpC,EAAE,MAAM,CAAC,YAAY,EAAE,oBAAoB,EAAE,KAAK,CAAC;AACnD,EAAE,MAAM,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK;AACnC,EAAE,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,oDAAO,YAAW,KAAC,CAAC;AAC5C;AACA,EAAE,IAAI;AACN,GAAG,MAAM,OAAO,GAAG,MAAM,GAAG,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;AAC/C;AACA,GAAG,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,IAAI,KAAK;AAClC,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AAC/B,IAAI,CAAC,CAAC;AACN;AACA,GAAG,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,IAAI,KAAK;AAClC,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AAC/B,IAAI,CAAC,CAAC;AACN;AACA,GAAG,OAAO,CAAC,GAAG,CAACF,UAAM,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,gCAAgC,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AACtF,GAAG,IAAI,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAClC,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC;AACvB,GAAG;AACH,EAAE,CAAC,CAAC;AACJ;AACA,IAAI;AACJ,EAAE,OAAO,CAAC,OAAO,CAAC;AAClB,EAAE,QAAQ,CAAC,uCAAuC,CAAC;AACnD,EAAE,MAAM,CAAC,YAAY;AACrB,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,oDAAO,aAAa,KAAC,CAAC;AAChD;AACA,EAAE,IAAI;AACN,GAAG,MAAM,KAAK,CAAC,MAAM,CAAC,CAAC;AACvB,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC;AACvB,GAAG;AACH,EAAE,CAAC,CAAC;AACJ;AACA,IAAI;AACJ,EAAE,OAAO,CAAC,OAAO,CAAC;AAClB,EAAE,QAAQ,CAAC,4BAA4B,CAAC;AACxC,EAAE,MAAM,CAAC,YAAY,EAAE,MAAM,EAAE,IAAI,CAAC;AACpC,EAAE,MAAM,CAAC,YAAY,EAAE,oBAAoB,EAAE,KAAK,CAAC;AACnD,EAAE,MAAM,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,KAAK;AACnC,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,oDAAO,aAAa,KAAC,CAAC;AAChD;AACA,EAAE,IAAI;AACN,GAAG,MAAM,KAAK,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;AACjC;AACA,GAAG,OAAO,CAAC,GAAG,CAACA,UAAM,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,gCAAgC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9E,GAAG,IAAI,IAAI,EAAE,IAAI,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;AACpC,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC;AACvB,GAAG;AACH,EAAE,CAAC,CAAC;AACJ;AACA,IAAI;AACJ,EAAE,OAAO,CAAC,OAAO,CAAC;AAClB,EAAE,QAAQ,CAAC,yDAAyD,CAAC;AACrE,EAAE,MAAM,CAAC,YAAY;AACrB,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,oDAAO,aAAa,KAAC,CAAC;AAChD;AACA,EAAE,IAAI;AACN,GAAG,MAAM,KAAK,CAAC,MAAM,CAAC,CAAC;AACvB,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,GAAG,YAAY,CAAC,KAAK,CAAC,CAAC;AACvB,GAAG;AACH,EAAE,CAAC,CAAC;AACJ;AACA,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE,CAAC,GAAG,KAAK,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC,EAAE,CAAC;;"}